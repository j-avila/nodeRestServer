<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<script src="https://apis.google.com/js/platform.js" async defer></script>
		<meta
			name="google-signin-client_id"
			content="274383636599-877ud7tg19b1lvifvabqf0uev40oh40j.apps.googleusercontent.com"
		/>

		<link
			rel="stylesheet"
			href="https://fonts.googleapis.com/icon?family=Material+Icons"
		/>
		<link
			rel="stylesheet"
			href="https://code.getmdl.io/1.3.0/material.light_green-teal.min.css"
		/>
		<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
	</head>
	<body>
		<div class="g-signin2" data-onsuccess="onSignIn"></div>

		<button
			class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent"
			onclick="signOut();"
		>
			Sign out
		</button>
	</body>
</html>

<script>
	// login with google auth
	function onSignIn(googleUser) {
		var profile = googleUser.getBasicProfile()
		// console.log("ID: " + profile.getId()) // Do not send to your backend! Use an ID token instead.
		// console.log("Name: " + profile.getName())
		// console.log("Image URL: " + profile.getImageUrl())
		// console.log("Email: " + profile.getEmail()) // This is null if the 'email' scope is not present.

		var id_token = googleUser.getAuthResponse().id_token
		var xhr = new XMLHttpRequest()
		xhr.open("POST", "/google-auth")
		xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
		xhr.onload = function () {
			console.log("Signed in as: " + xhr.responseText)
		}
		xhr.send("idtoken=" + id_token)
	}

	// logout from google auth
	function signOut() {
		var auth2 = gapi.auth2.getAuthInstance()
		auth2.signOut().then(function () {
			console.log("User signed out.")
		})
	}
</script>
